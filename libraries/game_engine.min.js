var Game;!function(a){var b;!function(a){function b(b){if(!a.isArray(b))throw new Error("Utilities.shuffle() -> Invalid 'array' argument. Not an array.");for(var c,d,e=b.length;0!==e;)d=Math.floor(Math.random()*e),e--,c=b[e],b[e]=b[d],b[d]=c;return b}function c(b){if(!a.isString(b))throw new Error("Utilities.getObject() -> Invalid 'key' argument. Not a string.");var c=localStorage.getItem(b);return c&&JSON.parse(c)}function d(b,c){if(!a.isString(b))throw new Error("Utilities.saveObject() -> Invalid 'key' argument. Not a string.");localStorage.setItem(b,JSON.stringify(c))}function e(a){return"[object Array]"===Object.prototype.toString.call(a)}function f(a){return a===!0||a===!1||"[object Boolean]"===Object.prototype.toString.call(a)}function g(a){return"function"==typeof a&&"[object Function]"===Object.prototype.toString.call(a)}function h(b){return a.isNumber(b)&&b%1===0}function i(a){return"number"==typeof a&&!isNaN(parseFloat(a))&&isFinite(a)}function j(a){return"string"==typeof a||a instanceof String}function k(b,c){if(!a.isNumber(b)||!a.isNumber(c)||b>c)throw new Error("Utilities.getRandomFloat() -> Invalid arguments. Either 'min'/'max' are not numbers, or 'min' > 'max'.");return Math.random()*(c-b)+b}function l(b,c){if(!a.isInteger(b)||!a.isInteger(c)||b>c)throw new Error("Utilities.getRandomInt() -> Invalid arguments. Either 'min'/'max' are not integers, or 'min > 'max'.");return Math.floor(Math.random()*(c-b+1))+b}function m(b,c,d){if(!a.isInteger(b)||!a.isInteger(c)||!a.isInteger(d)||b>c||d-1>c-b)throw new Error("Utilities.getSeveralRandomInts() -> Invalid arguments.");for(var e=[];e.length<d;){var f=a.getRandomInt(b,c);e.indexOf(f)<0&&e.push(f)}return e}function n(b){if(!a.isNumber(b))throw new Error("Utilities.numberOfDigits() -> Invalid 'theNumber' argument. Not a number.");0>b&&(b*=-1);var c=b.toString().replace(".","");return c.length}function o(b,c){if(!a.isNumber(b)||!a.isInteger(c)||0>c)throw new Error("Utilities.round() -> Invalid arguments.");return Math.round(b*Math.pow(10,c))/Math.pow(10,c)}function p(a){return JSON.parse(JSON.stringify(a))}function q(b,c){if(!a.isArray(b))throw new Error("Utilities.createEnum() -> Invalid 'values' argument. Needs to be an array of strings.");a.isNumber(c)||(c=0);for(var d,e={},f=b.length,g=0;f>g;g++)d=b[g],e[c]=d,e[d]=c,c++;return e}function r(a,b){var c=function(){};c.prototype=b.prototype;var d=new c;d.constructor=a,a.prototype=d}function s(b,c){if(void 0===c&&(c=2),!a.isNumber(b))throw new Error("Utilities.timeToString() -> Invalid 'dateMilliseconds' argument. Not a number.");a.isNumber(c)||(c=2);for(var d=1e3,e=60*d,f=60*e,g=24*f,h=0,i=0,j=0,k=0;b>=g;)j++,b-=g;for(;b>=f;)i++,b-=f;for(;b>=e;)h++,b-=e;k=a.round(b/d,2);var l,m=[["day",j],["hour",i],["minute",h],["second",k]],n=function(a,b){return 1!==b&&(a+="s"),b+" "+a},o="";for(l=0;l<m.length&&0!==c;l++)0!==m[l][1]&&(""!==o&&(o+=" "),o+=n(m[l][0],m[l][1]),c--);return""===o&&(o="0 seconds"),o}function t(b,c,d,e){if(!(a.isNumber(b)&&a.isNumber(c)&&a.isNumber(d)&&a.isNumber(e)))throw new Error("Utilities.calculateAngle() -> Invalid arguments. Needs to be a number.");var f=c-e,g=d-b;return Math.atan2(f,g)}function u(b,c,d,e){if(!(a.isNumber(b)&&a.isNumber(c)&&a.isNumber(d)&&a.isNumber(e)))throw new Error("Utilities.calculateDistance() -> Invalid arguments. Needs to be a number.");var f=e-c,g=d-b;return Math.sqrt(Math.pow(f,2)+Math.pow(g,2))}function v(b){if(!a.isNumber(b))throw new Error("Utilities.toDegrees() -> Invalid 'radians' argument. Not a number.");return 180*b/Math.PI}function w(b){if(!a.isNumber(b))throw new Error("Utilities.toRadians() -> Invalid 'degrees' argument. Not a number.");return b*Math.PI/180}a.shuffle=b,a.KEY_CODE={backspace:8,tab:9,enter:13,esc:27,space:32,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},a.MOUSE_CODE={left:0,middle:1,right:2},a.getObject=c,a.saveObject=d,a.isArray=e,a.isBoolean=f,a.isFunction=g,a.isInteger=h,a.isNumber=i,a.isString=j,a.getRandomFloat=k,a.getRandomInt=l,a.getSeveralRandomInts=m,a.numberOfDigits=n,a.round=o,a.deepClone=p,a.createEnum=q,a.inheritPrototype=r,a.timeToString=s;var x=function(){function b(){this.is_active=!1,this.id=-1}return b.prototype.start=function(b,c){if(!a.isFunction(b)||!a.isNumber(c))throw new Error("Utilities.Timeout.start() -> Invalid arguments.");var d=this;this.is_active&&this.clear(),this.is_active=!0,this.id=window.setTimeout(function(){d.is_active=!1,b()},c)},b.prototype.clear=function(){window.clearTimeout(this.id),this.is_active=!1},b}();a.Timeout=x;var y=function(){function b(a){if(!(a instanceof HTMLElement))throw new Error("Utilities.Timer() -> Invalid 'htmlElement' argument. Not an HTML element.");this.is_active=!1,this.start_value=0,this.end_value=null,this.end_callback=null,this.tick_callback=null,this.count_down=!1,this.time_count=0,this.interval_f=null,this.html_element=a,this.html_element.innerHTML=this.getTimeString()}return b.prototype.start=function(b){"undefined"==typeof b&&(b={}),a.isNumber(b.startValue)||(b.startValue=0),a.isNumber(b.endValue)||(b.endValue=null),a.isFunction(b.endCallback)||(b.endCallback=null),a.isFunction(b.tickCallback)||(b.tickCallback=null),b.countDown!==!0&&(b.countDown=!1),this.is_active&&this.stop(),this.count_down=b.countDown,this.time_count=b.startValue,this.start_value=b.startValue,this.end_value=b.endValue,this.end_callback=b.endCallback,this.tick_callback=b.tickCallback,this.html_element.innerHTML=this.getTimeString(),this.resume()},b.prototype.resume=function(){if(!this.is_active){var a=this,b=1e3;this.is_active=!0,this.interval_f=window.setInterval(function(){if(a.count_down?a.time_count-=b:a.time_count+=b,null!==a.end_value){var c=!1;a.count_down?a.time_count<=a.end_value&&(c=!0):a.time_count>=a.end_value&&(c=!0),c&&(a.stop(),null!==a.end_callback&&a.end_callback())}null!==a.tick_callback&&a.tick_callback(),a.html_element.innerHTML=a.getTimeString()},b)}},b.prototype.stop=function(){this.interval_f&&(window.clearInterval(this.interval_f),this.interval_f=null),this.is_active=!1},b.prototype.reset=function(){this.stop(),this.time_count=this.start_value,this.html_element.innerHTML=this.getTimeString()},b.prototype.restart=function(){this.reset(),this.start({startValue:this.start_value,endValue:this.end_value,endCallback:this.end_callback,tickCallback:this.tick_callback,countDown:this.count_down})},b.prototype.add=function(a){this.time_count+=a},b.prototype.getTimeString=function(){return a.timeToString(this.time_count)},b.prototype.getTimeSeconds=function(){return this.time_count/1e3},b.prototype.getTimeMilliseconds=function(){return this.time_count},b}();a.Timer=y,a.calculateAngle=t,a.calculateDistance=u,a.toDegrees=v,a.toRadians=w}(b=a.Utilities||(a.Utilities={}))}(Game||(Game={}));var Game;!function(a){var b=function(){function b(a){this._listeners={}}return b.prototype.addEventListener=function(b,c){return this._listeners[b]||(this._listeners[b]=[]),a.Utilities.isFunction(c)&&this._listeners[b].indexOf(c)<0?(this._listeners[b].push(c),!0):!1},b.prototype.removeEventListener=function(a,b){if(this._listeners[a]){if("undefined"==typeof b)return this._listeners[a]=[],!0;var c=this._listeners[a].indexOf(b);if(c>=0)return this._listeners.splice(c,1),!0}return!1},b.prototype.removeAllEventListeners=function(){this._listeners={}},b.prototype.dispatchEvent=function(a,b){var c=this._listeners[a];if(c)for(var d=c.length-1;d>=0;d--)c[d](b)},b.prototype.hasListeners=function(a){return this._listeners[a]&&this._listeners[a].length>0?!0:!1},b}();a.EventDispatcher=b}(Game||(Game={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Game;!function(a){var b=function(b){function c(a){b.call(this,a);var c=0,d=0;"undefined"!=typeof a&&("undefined"!=typeof a.x&&(c=a.x),"undefined"!=typeof a.y&&(d=a.y)),this.x=c,this.y=d,this._width=this._half_width=0,this._height=this._half_height=0,this.visible=!0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.column=-1,this.line=-1,this.vertices=null,this._rotation=0,this._container=null,this._has_logic=!1,this._removed=!1}return __extends(c,b),c.prototype.drawElement=function(a){throw new Error("Implement .drawElement().")},c.prototype.draw=function(a){this.drawElement(a)},c.prototype.logic=function(a){},c.prototype.intersect=function(b,c){var d=[],e=this.vertices;return e&&a.CollisionDetection.polygonPoint(this.vertices,{x:b,y:c})&&d.push(this),d},c.prototype.mouseClickEvents=function(a,b,c){if(this.hasListeners(c.type)){var d=this.intersect(a,b);if(d.length>0)return d[0].dispatchMouseClickEvent(c),!0}return!1},c.prototype.dispatchMouseOverEvent=function(){this._container&&this._container.dispatchMouseOverEvent(),this.dispatchEvent("mouseover",{element:this})},c.prototype.dispatchMouseOutEvent=function(){this._container&&this._container.dispatchMouseOutEvent(),this.dispatchEvent("mouseout",{element:this})},c.prototype.dispatchMouseMoveEvent=function(){this._container&&this._container.dispatchMouseMoveEvent(),this.dispatchEvent("mousemove",{element:this})},c.prototype.dispatchMouseClickEvent=function(a){this._container&&this._container.dispatchMouseClickEvent(a),this.dispatchEvent(a.type,{event:a})},c.prototype.getWidth=function(){return this._width},c.prototype.getHeight=function(){return this._height},c.prototype.setWidth=function(a){this._width=a,this._half_width=a/2},c.prototype.setHeight=function(a){this._height=a,this._half_height=a/2},c.prototype.setDimensions=function(a,b){this._width=a,this._half_width=a/2,this._height=b,this._half_height=b/2},Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this.rotate(a,!1)},enumerable:!0,configurable:!0}),c.prototype.rotate=function(a,b){b===!0?this._rotation=Math.PI/180*a:this._rotation=a},c.prototype.remove=function(){this._removed||(this._removed=!0,null!==this._container?(this._container.removeChild(this),this._container=null):a.removeElement(this))},c.prototype.isRemoved=function(){return this._removed},c.prototype.clone=function(){throw new Error("Implement .clone().")},c.prototype.updateVertices=function(b,c,d,e,f){d*=this.scaleX,e*=this.scaleY;var g={x:b+this.x*d,y:c+this.y*e},h=g.x-this._half_width*d,i=g.x+this._half_width*d,j=g.y-this._half_height*e,k=g.y+this._half_height*e,l=this._rotation+f;this.vertices=[a.Vector.rotate(g,{x:h,y:j},l),a.Vector.rotate(g,{x:i,y:j},l),a.Vector.rotate(g,{x:i,y:k},l),a.Vector.rotate(g,{x:h,y:k},l)]},c.prototype.getVertices=function(){return this.vertices?[this.vertices]:null},c}(a.EventDispatcher);a.Element=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this.image=a.image,this._source_x=0,this._source_y=0}return __extends(c,b),c.prototype.drawElement=function(a){a.save(),a.beginPath(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.scale(this.scaleX,this.scaleY),a.rotate(this._rotation),a.drawImage(this._image,this._source_x,this._source_y,this._width,this._height,-this._half_width,-this._half_height,this._width,this._height),a.restore()},c.prototype.clone=function(){var b=new a.Bitmap({x:this.x,y:this.y,image:this._image});return b.opacity=this.opacity,b.visible=this.visible,b.scaleX=this.scaleX,b.scaleY=this.scaleY,b._rotation=this._rotation,b},Object.defineProperty(c.prototype,"image",{get:function(){return this._image},set:function(a){this._width=a.width,this._height=a.height,this._half_width=a.width/2,this._half_height=a.height/2,this._image=a},enumerable:!0,configurable:!0}),c}(a.Element);a.Bitmap=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this._children=[],this._has_logic=!0,"undefined"!=typeof a&&"undefined"!=typeof a.children&&this.addChild(a.children)}return __extends(c,b),c.prototype.addChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++){var e=b[d];this._children.push(e),e._container=this}this.calculateDimensions()},c.prototype.removeChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this._children.indexOf(e);f>=0&&this._children.splice(f,1),e.container=null}},c.prototype.removeAllChildren=function(){for(var a=this._children.length-1;a>=0;a--)this._children[a]._container=null,this._children[a].remove();this._children.length=0},c.prototype.remove=function(){this.removeAllChildren(),b.prototype.remove.call(this)},c.prototype.draw=function(a){a.save(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.scale(this.scaleX,this.scaleY),a.rotate(this._rotation);for(var b,c=this._children.length,d=0;c>d;d++)b=this._children[d],b.visible&&b.drawElement(a);a.restore()},c.prototype.drawElement=function(a){this.draw(a)},c.prototype.intersect=function(a,b){for(var c,d=[],e=this._children.length-1;e>=0;e--)c=this._children[e].intersect(a,b),c.length>0&&(d=d.concat(c));return d},c.prototype.mouseClickEvents=function(a,b,c){for(var d=!1,e=this._children.length-1;e>=0;e--)this._children[e].mouseClickEvents(a,b,c)&&(d=!0);return d},c.prototype.calculateDimensions=function(){0===this._children.length&&(this._width=this._height=0,this._half_width=this._half_height=0);for(var a=this._children[0],b=a.x,c=a.x+a._width,d=a.y,e=a.y+a._height,f=this._children.length,g=1;f>g;g++){var h=this._children[g];h.x<b?b=h.x:h.x+h._width>c&&(c=h.x+h._width),h.y<d?d=h.y:h.y+h._height>e&&(e=h.y+h._height)}this._width=c-b,this._height=e-d,this._half_width=this._width/2,this._half_height=this._height/2},c.prototype.logic=function(a){for(var b=this._children.length-1;b>=0;b--){var c=this._children[b];c._has_logic===!0&&c.logic(a)}},c.prototype.updateVertices=function(a,b,c,d,e){a+=this.x*c,b+=this.y*d,c*=this.scaleX,d*=this.scaleY,e+=this.rotation;for(var f=this._children.length-1;f>=0;f--)this._children[f].updateVertices(a,b,c,d,e)},c.prototype.getVertices=function(){for(var a=[],b=this._children.length-1;b>=0;b--){var c=this._children[b].getVertices();c&&(a=a.concat(c))}return a},c.prototype.clone=function(){for(var b=[],c=this._children.length,d=0;c>d;d++)b.push(this._children[d].clone());var e=new a.Container({x:this.x,y:this.y,children:b});return e.opacity=this.opacity,e.visible=this.visible,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e._rotation=this._rotation,e},c}(a.Element);a.Container=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){"undefined"==typeof a&&(a={}),b.call(this,a),"undefined"==typeof a.angleOrTarget&&(a.angleOrTarget=0),"undefined"==typeof a.movementSpeed&&(a.movementSpeed=100),this.movement_speed=a.movementSpeed;var c=a.angleOrTarget;"number"==typeof c?this.setAngle(c):this.setTarget(c)}return __extends(c,b),c.prototype.setAngle=function(a){this._move_x=Math.cos(a)*this.movement_speed,this._move_y=Math.sin(a)*this.movement_speed,this.rotation=a,this.logic=this.fixedLogic},c.prototype.setTarget=function(a){this._target=a,this.logic=this.targetLogic},c.prototype.fixedLogic=function(b){this.x+=this._move_x*b,this.y+=this._move_y*b,a.getCanvas().isInCanvas(this.x,this.y)||this.remove()},c.prototype.targetLogic=function(b){var c=this._target;if(c.isRemoved())return void this.remove();var d=a.Utilities.calculateAngle(this.x,-1*this.y,c.x,-1*c.y);this.x+=Math.cos(d)*this.movement_speed*b,this.y+=Math.sin(d)*this.movement_speed*b,this.rotation=d,a.CollisionDetection.polygonPolygonList(this.getVertices(),c.getVertices())&&(this.dispatchEvent("collision",{element:this,collidedWith:c}),this.remove())},c.prototype.logic=function(a){},c.prototype.remove=function(){this._removed||(this._target=null,this.dispatchEvent("remove",{element:this}),b.prototype.remove.call(this))},c.prototype.clone=function(){for(var b=[],c=this._children.length,d=0;c>d;d++)b.push(this._children[d].clone());var e;e=this._target?this._target:this.rotation;var f=new a.Bullet({x:this.x,y:this.y,children:b,movementSpeed:this.movement_speed,angleOrTarget:e});return f.opacity=this.opacity,f.visible=this.visible,f.scaleX=this.scaleX,f.scaleY=this.scaleY,f},c}(a.Container);a.Bullet=b}(Game||(Game={}));var Game;!function(a){var b=function(){function b(a){this._canvas=document.createElement("canvas"),this._canvas.className="Game-Canvas",this._ctx=this._canvas.getContext("2d"),this._canvas.width=this._width=a.width,this._canvas.height=this._height=a.height,this._children=[],this.events_enabled=!0,this.update_on_loop=!0}return b.prototype.addChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++)this._children.push(b[d])},b.prototype.removeChild=function(a){var b=arguments,c=!1;a instanceof Array&&(b=a);for(var d=b.length,e=0;d>e;e++){var f=b[e],g=this._children.indexOf(f);g>=0&&(this._children.splice(g,1),c=!0)}return c},b.prototype.getChildrenIn=function(a,b){for(var c,d=[],e=this._children.length-1;e>=0;e--)c=this._children[e].intersect(a,b),c.length>0&&(d=d.concat(c));return d},b.prototype.updateVertices=function(){for(var a=this._children.length-1;a>=0;a--)this._children[a].updateVertices(0,0,1,1,0)},b.prototype.logic=function(a){for(var b=this._children.length-1;b>=0;b--){var c=this._children[b];c._has_logic===!0&&c.logic(a)}},b.prototype.draw=function(){this._ctx.clearRect(0,0,this._width,this._height);for(var a=this._children.length,b=0;a>b;b++){var c=this._children[b];c.visible&&c.draw(this._ctx)}},b.prototype.mouseClickEvents=function(a){for(var b,c=this._children,d=this._canvas.getBoundingClientRect(),e=a.clientX-d.left,f=a.clientY-d.top,g=c.length-1;g>=0&&(b=c[g],!b.mouseClickEvents(e,f,a));g--);},b.prototype.updateDimensions=function(a,b){this._canvas.width=this._width=a,this._canvas.height=this._height=b},b.prototype.getRandomPosition=function(){return{x:a.Utilities.getRandomInt(0,this._width),y:a.Utilities.getRandomInt(0,this._height)}},b.prototype.isInCanvas=function(a,b){return 0>a||a>this._width||0>b||b>this._height?!1:!0},b.prototype.getWidth=function(){return this._width},b.prototype.getHeight=function(){return this._height},b.prototype.getHtmlCanvasElement=function(){return this._canvas},b.prototype.getCanvasContext=function(){return this._ctx},b.prototype.getAllChildren=function(){return this._children},b}();a.Canvas=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this._radius=a.radius,this._width=this._height=2*a.radius,this._half_width=this._half_height=a.radius,this.color=a.color}return __extends(c,b),Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a,this._width=this._height=2*a,this._half_width=this._half_height=a},enumerable:!0,configurable:!0}),c.prototype.drawElement=function(a){a.save(),a.beginPath(),a.globalAlpha*=this.opacity,a.fillStyle=this.color,a.translate(this.x,this.y),a.scale(this.scaleX,this.scaleY),a.rotate(this._rotation),a.arc(0,0,this._radius,0,2*Math.PI),a.fill(),a.restore()},c.prototype.clone=function(){var b=new a.Circle({x:this.x,y:this.y,radius:this._radius,color:this.color});return b.opacity=this.opacity,b.visible=this.visible,b.scaleX=this.scaleX,b.scaleY=this.scaleY,b._rotation=this._rotation,b},c}(a.Element);a.Circle=b}(Game||(Game={}));var Game;!function(a){var b;!function(b){function c(a,b){var c,d,e,i,j=f(a),k=f(b);for(c=0;c<j.length;c++)if(d=j[c],e=g(a,d),i=g(b,d),!h(e,i))return!1;for(c=0;c<k.length;c++)if(d=k[c],e=g(a,d),i=g(b,d),!h(e,i))return!1;return!0}function d(a,b){for(var d=a.length-1;d>=0;d--)for(var e=a[d],f=b.length-1;f>=0;f--){var g=b[f],h=c(e,g);if(h)return!0}return!1}function e(a,b){var c,d,e=!1,f=a[0].x,g=f,h=a[0].y,i=h;for(c=1;c<a.length;c++){var j=a[c];f=Math.min(j.x,f),g=Math.max(j.x,g),h=Math.min(j.y,h),i=Math.max(j.y,i)}if(b.x<f||b.x>g||b.y<h||b.y>i)return!1;for(c=0,d=a.length-1;c<a.length;d=c++)a[c].y>b.y!=a[d].y>b.y&&b.x<(a[d].x-a[c].x)*(b.y-a[c].y)/(a[d].y-a[c].y)+a[c].x&&(e=!e);return e}function f(b){for(var c=b.length,d=[],e=0;c>e;e++){var f=b[e],g=e+1;g>=c&&(g=0);var h=b[g],i=a.Vector.subtract(f,h);d[e]=a.Vector.normalRight(i)}return d}function g(b,c){for(var d=a.Vector.dotProduct(c,b[0]),e=d,f=1;f<b.length;f++){var g=a.Vector.dotProduct(c,b[f]);d>g?d=g:g>e&&(e=g)}return{min:d,max:e}}function h(a,b){return!(a.min>b.max||b.min>a.max)}function i(a,b,c,d,e,f,g,h){return!(f>b+d||b>f+h||a>e+g||e>a+c)}function j(a,b,c,d,e,f){var g=a-d,h=b-e;return Math.pow(g,2)+Math.pow(h,2)<=Math.pow(c+f,2)?!0:!1}function k(a,b,c,d,e){var f=a-d,g=b-e,h=f*f+g*g;return c*c>=h?!0:!1}function l(a,b,c,d,e,f){return c>a||a>c+e||d>b||b>d+f?!1:!0}b.polygonPolygon=c,b.polygonPolygonList=d,b.polygonPoint=e,b.boxBox=i,b.circleCircle=j,b.circlePoint=k,b.pointBox=l}(b=a.CollisionDetection||(a.CollisionDetection={}))}(Game||(Game={}));var Game;!function(a){var b=function(){function b(a){this._grid=[];for(var b=0;b<a.columns;b++){this._grid[b]=[];for(var c=0;c<a.lines;c++)this._grid[b][c]=null}this.columns=a.columns,this.lines=a.lines}return b.prototype.add=function(a,b,c){if(!this.isInGrid(b,c))throw new Error("Invalid column/line position.");var d=this._grid[b][c];return this._grid[b][c]=a,d},b.prototype.move=function(a,b,c,d){if(!this.isInGrid(a,b)||!this.isInGrid(c,d))throw new Error("Invalid column/line position.");var e=this._grid[a][b],f=this._grid[c][d];return this._grid[a][b]=null,this._grid[c][d]=e,f},b.prototype.remove=function(a,b){if(!this.isInGrid(a,b))throw new Error("Invalid column/line position.");var c=this._grid[a][b];return this._grid[a][b]=null,c},b.prototype.get=function(a,b){if(!this.isInGrid(a,b))throw new Error("invalid column/line position.");return this._grid[a][b]},b.prototype.isEmpty=function(a,b){if(!this.isInGrid(a,b))throw new Error("Invalid column/line position.");return null===this._grid[a][b]?!0:!1},b.prototype.normalizePosition=function(a,b){return 0>a?a=0:a>=this.columns&&(a=this.columns-1),0>b?b=0:b>=this.lines&&(b=this.lines-1),{column:a,line:b}},b.prototype.isInGrid=function(a,b){return 0>a||a>=this.columns||0>b||b>=this.lines?!1:!0},b.prototype.getRandomPosition=function(){return{column:a.Utilities.getRandomInt(0,this.columns-1),line:a.Utilities.getRandomInt(0,this.lines-1)}},b.prototype.getRandomEmptyPosition=function(){var b=this.getEmptyPositions();if(b.length>0){var c=a.Utilities.getRandomInt(0,b.length-1);return b[c]}return null},b.prototype.getEmptyPositions=function(){for(var a=[],b=0;b<this.columns;b++)for(var c=0;c<this.lines;c++)null===this._grid[b][c]&&a.push({column:b,line:c});return a},b.prototype.getNeighbors=function(a,b,c){if(!this.isInGrid(a,b))throw new Error("Invalid column/line position.");"undefined"==typeof c&&(c=1);for(var d,e=[],f=this.normalizePosition(a-c,b-c),g=this.normalizePosition(a+c,b+c),h=f.column;h<=g.column;h++)for(var i=f.line;i<=g.line;i++)(h!==a||i!==b)&&(d=this.get(h,i),null!==d&&e.push(d));return e},b}();a.Grid=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(c){if(b.call(this,c),"undefined"==typeof c.refX&&(c.refX=c.squareSize/2),"undefined"==typeof c.refY&&(c.refY=c.squareSize/2),"undefined"!=typeof c.background){var d=c.squareSize*c.columns,e=c.squareSize*c.lines;this._background=new a.Rectangle({x:c.refX+d/2-c.squareSize/2,y:c.refY+e/2-c.squareSize/2,width:d,height:e,color:c.background.color,fill:c.background.fill}),"undefined"==typeof c.background.canvasId&&(c.background.canvasId=0),a.getCanvas(c.background.canvasId).addChild(this._background)}else this._background=null;this.events=new a.EventDispatcher(c),this.square_size=c.squareSize,this.ref_x=c.refX,this.ref_y=c.refY}return __extends(c,b),c.prototype.toCanvas=function(a,b){return{x:this.ref_x+a*this.square_size,y:this.ref_y+b*this.square_size}},c.prototype.toGrid=function(a,b){return{column:Math.round((a-this.ref_x)/this.square_size),line:Math.round((b-this.ref_y)/this.square_size)}},c.prototype.add=function(a,c,d){var e=b.prototype.add.call(this,a,c,d),f=this.toCanvas(c,d);return a.x=f.x,a.y=f.y,a.column=c,a.line=d,null!==e&&this.events.dispatchEvent("collision",{element:a,collidedWith:e}),e},c.prototype.move=function(c,d,e,f,g){var h=this.get(c,d);if(null===h||c===e&&d===f)return null;var i=b.prototype.move.call(this,c,d,e,f),j=this.toCanvas(e,f);if(h.column=e,h.line=f,"undefined"==typeof g||0>=g)h.x=j.x,h.y=j.y;else{var k=new a.Tween(h);k.to({x:j.x,y:j.y},g),k.start()}return null!==i&&(i.column=-1,i.line=-1,this.events.dispatchEvent("collision",{element:h,collidedWith:i})),i},c.prototype.remove=function(a,c){var d=b.prototype.remove.call(this,a,c);return null!==d&&(d.column=-1,d.line=-1),d},c.prototype.getDimensions=function(){return{x:this.ref_x,y:this.ref_y,width:this.square_size*this.columns,height:this.square_size*this.lines}},c.prototype.clear=function(){null!==this._background&&this._background.remove()},c}(a.Grid);a.ElementGrid=b}(Game||(Game={}));var Game;!function(a){function b(b,e,f){u=document.createElement("div"),u.id="Game-canvasContainer",b.appendChild(u);var g=new a.Canvas({width:e,height:f});a.addCanvas(g),a.Sound.init(),u.addEventListener("click",o),u.addEventListener("mousedown",o),u.addEventListener("mouseup",o),document.addEventListener("visibilitychange",function(a){document.hidden?d():c()}),c()}function c(){z=!1,v=(new Date).getTime(),q()}function d(){z=!0,window.cancelAnimationFrame(w)}function e(a){A.length=0,u.addEventListener("mousemove",g),x=window.setInterval(p,a)}function f(){window.clearInterval(x),u.removeEventListener("mousemove",g)}function g(a){B=a.clientX,C=a.clientY,D=!0}function h(a){return"undefined"==typeof a&&(a=0),y[a]}function i(b,c){a.Utilities.isNumber(c)?0>c?c=0:c>y.length&&(c=y.length):c=y.length;var d=y[c];return y.splice(c,0,b),d?u.insertBefore(b._canvas,d._canvas):u.appendChild(b._canvas),c}function j(a,b){return"undefined"==typeof b&&(b=0),y[b].addChild(a)}function k(a){for(var b=y.length-1;b>=0;b--){var c=y[b],d=c.removeChild(a);if(d)return!0}return!1}function l(b,c,d){return a.Utilities.isFunction(b)&&a.Utilities.isNumber(c)?(d!==!1&&(d=!0),E.push({callback:b,isInterval:d,delay:c,count:0}),!0):!1}function m(a){for(var b=E.length-1;b>=0;b--){var c=E[b];if(c.callback===a)return E.splice(b,1),!0}return!1}function n(){E.length=0}function o(a){for(var b=y.length-1;b>=0;b--){var c=y[b];c.events_enabled&&c.mouseClickEvents(a)}}function p(){var a,b,c,d=[];for(b=y.length-1;b>=0;b--){var e=y[b];if(e.events_enabled){var f=e._canvas.getBoundingClientRect(),g=B-f.left,h=C-f.top;a=e.getChildrenIn(g,h),a.length>0&&(d=d.concat(a))}}if(d.length>0){if(D){for(b=d.length-1;b>=0;b--)d[b].dispatchMouseMoveEvent();D=!1}for(b=A.length-1;b>=0;b--)c=A[b],d.indexOf(c)<0&&(A.splice(b,1),c.dispatchMouseOutEvent());for(b=d.length-1;b>=0;b--)c=d[b],A.indexOf(c)<0&&(c.dispatchMouseOverEvent(),A.push(c))}else{for(b=A.length-1;b>=0;b--)A[b].dispatchMouseOutEvent();A.length=0}}function q(){var b=(new Date).getTime(),c=(b-v)/1e3;v=b,r(c),a.Tween.update(c);for(var d=y.length-1;d>=0;d--){var e=y[d];e.update_on_loop&&(e.updateVertices(),e.logic(c),e.draw())}z||(w=window.requestAnimationFrame(q))}function r(a){for(var b=E.length-1;b>=0;b--){var c=E[b];c.delay<=0?(c.callback(),c.isInterval||E.splice(b,1)):(c.count+=a,c.count>=c.delay&&(c.count=0,c.callback(),c.isInterval||E.splice(b,1)))}}function s(){return u}function t(){return{x:B,y:C}}var u,v,w,x,y=[],z=!1,A=[],B=-1,C=-1,D=!1,E=[];a.init=b,a.startGameLoop=c,a.stopGameLoop=d,a.activateMouseMoveEvents=e,a.disableMouseMoveEvents=f,a.getCanvas=h,a.addCanvas=i,a.addElement=j,a.removeElement=k,a.addToGameLoop=l,a.removeFromGameLoop=m,a.removeAllCallbacks=n,a.getCanvasContainer=s,a.getMousePosition=t}(Game||(Game={}));var Game;!function(a){var b;!function(b){function c(a,b,c){i=a,j=b,k=c===!0?function(a,b){return a-b}:function(a,b){return b-a},h()}function d(a,b){"undefined"==typeof l[a]&&(l[a]=[]),l[a].indexOf(b)>=0||(l[a].push(b),l[a].sort(k),l[a].length>i&&l[a].pop(),g())}function e(a){return l[a]}function f(){l={},localStorage.removeItem(j)}function g(){a.Utilities.saveObject(j,l)}function h(){var b=a.Utilities.getObject(j);b&&(l=b)}var i,j,k,l={};b.init=c,b.add=d,b.get=e,b.clear=f}(b=a.HighScore||(a.HighScore={}))}(Game||(Game={}));var Game;!function(a){var b;!function(b){var c=function(){function a(a){var b=document.createElement("div");if(b.className="Game-Element",this.container=b,this._is_active=!0,this._pre_text=null,"undefined"!=typeof a){"undefined"!=typeof a.cssId&&(b.id=a.cssId);var c=a.cssClass;if("undefined"!=typeof c)if("string"==typeof c)b.classList.add(c);else for(var d=c.length-1;d>=0;d--)b.classList.add(c[d]);if("undefined"!=typeof a.preText){var e=document.createElement("span");e.className="Game-preText",e.innerHTML=a.preText,b.appendChild(e),this._pre_text=e}}}return a.prototype.setActive=function(a){a!==this._is_active&&(a===!0?(this.addEvents(),this.container.classList.remove("Game-inactive")):(this.removeEvents(),this.container.classList.add("Game-inactive")),this._is_active=a)},a.prototype.isActive=function(){return this._is_active},a.prototype.addEvents=function(){},a.prototype.removeEvents=function(){},a.prototype.clear=function(){this._pre_text&&(this.container.removeChild(this._pre_text),this._pre_text=null),this.container.parentNode.removeChild(this.container),this.container=null},a}();b.HtmlElement=c;var d=function(a){function b(b){a.call(this,b),this.container.classList.add("Game-Container"),this._children=[],"undefined"!=typeof b&&"undefined"!=typeof b.children&&this.addChild(b.children)}return __extends(b,a),b.prototype.addChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++){var e=b[d];this._children.push(e),this.container.appendChild(e.container)}},b.prototype.removeChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this._children.indexOf(e);f>=0&&(this._children.splice(f,1),e.clear())}},b.prototype.removeAllChildren=function(){for(var a=this._children.length-1;a>=0;a--)this._children[a].clear();for(this._children.length=0;this.container.lastChild;)this.container.removeChild(this.container.lastChild)},b.prototype.clear=function(){this.removeAllChildren(),a.prototype.clear.call(this)},b}(c);b.HtmlContainer=d;var e=function(a){function b(b){a.call(this,b),this.element=document.createElement("span"),this.container.appendChild(this.element),this.container.classList.add("Game-Value"),this.setValue(b.value)}return __extends(b,a),b.prototype.setValue=function(a){a!==this.value&&(this.value=a,this.element.innerHTML=a)},b.prototype.getValue=function(){return this.value},b.prototype.clear=function(){this.container.removeChild(this.element),this.element=null,this.value=null,a.prototype.clear.call(this)},b}(c);b.Value=e;var f=function(a){function b(b){var c=this;"undefined"==typeof this.click_ref&&(this.click_ref=function(a){b.callback&&b.callback(c),a.stopPropagation()}),a.call(this,b),this.container.classList.add("Game-Button"),this.addEvents()}return __extends(b,a),b.prototype.addEvents=function(){this.container.addEventListener("click",this.click_ref)},b.prototype.removeEvents=function(){this.container.removeEventListener("click",this.click_ref)},b.prototype.clear=function(){this.removeEvents(),this.click_ref=null,a.prototype.clear.call(this)},b}(e);b.Button=f;var g=function(a){function b(b){var c=this;this.click_ref=function(a){c.setValue(!c.value),b.callback&&b.callback(c),a.stopPropagation()},a.call(this,b),this.container.classList.add("Game-Boolean"),this.addEvents()}return __extends(b,a),b.prototype.setValue=function(a){a!==this.value&&(a===!0?this.element.innerHTML="On":this.element.innerHTML="Off",this.value=a)},b.prototype.getValue=function(){return this.value},b}(f);b.Boolean=g;var h=function(a){function b(b){var c=this;this.isValue1=!0,this.click_ref=function(a){c.isValue1?(c.element.innerHTML=b.value2,
b.callback&&b.callback(c)):(c.element.innerHTML=b.value,b.callback2&&b.callback2(c)),c.isValue1=!c.isValue1,a.stopPropagation()},a.call(this,b),this.container.classList.add("Game-TwoState")}return __extends(b,a),b.prototype.getValue=function(){return this.element.innerHTML},b}(f);b.TwoState=h;var i=function(a){function b(b){var c=this;this.click_ref=function(){var a=this;if(a!==c.selected){var d=c.elements.indexOf(a);c.select(d),b.callback&&b.callback(c,d,a)}},a.call(this,b),this.elements=[];for(var d=b.options.length,e=0;d>e;e++){var f=document.createElement("span");f.innerHTML=b.options[e],this.container.appendChild(f),this.elements.push(f)}this.container.classList.add("Game-Button"),this.container.classList.add("Game-MultipleOptions"),this.selected=null,this.select(0),this.addEvents()}return __extends(b,a),b.prototype.select=function(a){var b=this.elements[a];b&&b!==this.selected&&(this.selected&&this.selected.classList.remove("Game-selected"),this.selected=b,b.classList.add("Game-selected"))},b.prototype.getValue=function(){return this.selected.innerHTML},b.prototype.addEvents=function(){for(var a=this.elements.length-1;a>=0;a--)this.elements[a].addEventListener("click",this.click_ref)},b.prototype.removeEvents=function(){for(var a=this.elements.length-1;a>=0;a--)this.elements[a].removeEventListener("click",this.click_ref)},b.prototype.clear=function(){this.removeEvents(),this.click_ref=null,this.selected=null;for(var b=this.elements.length-1;b>=0;b--)this.container.removeChild(this.elements[b]);this.elements.length=0,a.prototype.clear.call(this)},b}(c);b.MultipleOptions=i;var j=function(a){function b(b){var c=this;if("undefined"==typeof b.step)b.step=1,this.number_of_decimals=0;else{var d=b.step.toString().split(".");d.length>1?this.number_of_decimals=d[1].length:this.number_of_decimals=0}this.change_ref=function(a){c.setValue(parseFloat(a.target.value)),b.onChange&&b.onChange(c)},this.input_ref=function(a){var b=parseFloat(a.target.value);c.value.innerHTML=b.toFixed(c.number_of_decimals)},a.call(this,b),this.input=document.createElement("input"),this.input.type="range",this.input.min=b.min.toString(),this.input.max=b.max.toString(),this.input.value=b.value.toString(),this.input.step=b.step.toString(),this.value=document.createElement("span"),this.container.classList.add("Game-Range"),this.container.appendChild(this.input),this.container.appendChild(this.value),this.setValue(b.value),this.addEvents()}return __extends(b,a),b.prototype.setValue=function(a){if(a!==this.current_value){var b=a.toFixed(this.number_of_decimals);this.current_value=a,this.input.value=b,this.value.innerHTML=b}},b.prototype.getValue=function(){return this.current_value},b.prototype.addEvents=function(){this.input.addEventListener("input",this.input_ref),this.input.addEventListener("change",this.change_ref)},b.prototype.removeEvents=function(){this.input.removeEventListener("input",this.input_ref),this.input.removeEventListener("change",this.change_ref)},b.prototype.clear=function(){this.removeEvents(),this.change_ref=null,this.input_ref=null,this.container.removeChild(this.value),this.container.removeChild(this.input),this.value=null,this.input=null,a.prototype.clear.call(this)},b}(c);b.Range=j;var k=function(b){function c(c){var d=this;this.button=null,this.key_ref=null,"undefined"==typeof c&&(c={}),b.call(this,c);var e=document.createElement("input");e.type="text","undefined"!=typeof c.placeholder&&e.setAttribute("placeholder",c.placeholder),this.container.appendChild(e),this.input=e,"undefined"!=typeof c.callback&&(this.key_ref=function(b){var e=b.keyCode;e===a.Utilities.KEY_CODE.enter&&c.callback(d)}),"undefined"!=typeof c.buttonText&&(this.button=new a.Html.Button({value:c.buttonText,callback:function(){c.callback(d)}}),this.container.appendChild(this.button.container)),this.container.classList.add("Game-Text"),this.addEvents()}return __extends(c,b),c.prototype.setValue=function(a){this.input.value=a},c.prototype.getValue=function(){return this.input.value},c.prototype.addEvents=function(){this.input.addEventListener("keyup",this.key_ref),this.button&&this.button.addEvents()},c.prototype.removeEvents=function(){this.input.removeEventListener("keyup",this.key_ref),this.button&&this.button.removeEvents()},c.prototype.clear=function(){this.removeEvents(),this.key_ref=null,this.container.removeChild(this.input),this.input=null,this.button&&(this.button.clear(),this.button=null),b.prototype.clear.call(this)},c}(c);b.Text=k}(b=a.Html||(a.Html={}))}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(c){if(b.call(this,c),this.body=new a.Html.HtmlContainer({cssClass:"Game-Message-body"}),this.setBody(c.body),this.container.classList.add("Game-Message-container"),this.addChild(this.body),this.timeout=null,this.background=null,this.buttons=null,"undefined"!=typeof c.buttons){var d;d=c.buttons instanceof Array?c.buttons:[c.buttons];var e=d.length;this.buttons=new a.Html.HtmlContainer({cssClass:"Game-Message-Buttons"});for(var f=0;e>f;f++)this.buttons.addChild(d[f]);this.addChild(this.buttons)}if(a.Utilities.isNumber(c.timeout)){this.timeout=new a.Utilities.Timeout;var g=this;this.timeout.start(function(){g.clear()},1e3*c.timeout)}c.background===!0&&(this.background=document.createElement("div"),this.background.className="Game-Message-background",c.container.appendChild(this.background)),c.container.appendChild(this.container)}return __extends(c,b),c.prototype.clear=function(){this.timeout&&(this.timeout.clear(),this.timeout=null),this.background&&this.container.parentNode.removeChild(this.background),b.prototype.clear.call(this)},c.prototype.setBody=function(b){this.body.removeAllChildren(),b instanceof Array||(b=[b]);for(var c=b.length,d=0;c>d;d++){var e=b[d];if(e instanceof a.Html.HtmlElement)this.body.addChild(e);else if(e instanceof HTMLElement)this.body.container.appendChild(e);else{var f=document.createElement("div");f.innerHTML=e,this.body.container.appendChild(f)}}},c}(a.Html.HtmlContainer);a.Message=b}(Game||(Game={}));var Game;!function(a){var b;!function(a){function b(a,b,d){for(var e=[b],f=[],g={columns:a[0].length,lines:a.length,map:a,passableValue:d.passable},h=0;h<g.lines;h++){f[h]=[];for(var i=0;i<g.columns;i++)f[h][i]=null}for(f[b.line][b.column]=b;e.length>0;)for(var j=e.shift(),k=c(j,g),l=0;l<k.length;l++){var m=k[l];null===f[m.line][m.column]&&(e.push(m),f[m.line][m.column]=j)}return f}function c(a,b){var c=[],d=a.column,e=a.line,f=b.map,g=d-1,h=d+1,i=e-1,j=e+1;return d>0&&f[e][g]===b.passableValue&&c.push({column:g,line:e}),d+1<b.columns&&f[e][h]===b.passableValue&&c.push({column:h,line:e}),e>0&&f[i][d]===b.passableValue&&c.push({column:d,line:i}),e+1<b.lines&&f[j][d]===b.passableValue&&c.push({column:d,line:j}),c}a.breadthFirstSearch=b}(b=a.PathFinding||(a.PathFinding={}))}(Game||(Game={}));var Game;!function(a){var b;!function(a){function b(){try{e=new AudioContext}catch(a){e=null}}function c(a,b){if(!e)throw Error("AudioContext not supported in this browser.");e.decodeAudioData(a,b)}function d(a){if(!e)throw Error("AudioContext not supported in this browser.");var b=e.createBufferSource();b.buffer=a,b.connect(e.destination),b.start()}var e;a.init=b,a.decodeAudio=c,a.play=d}(b=a.Sound||(a.Sound={}))}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(c){b.call(this,c);var d=!1;"undefined"!=typeof c&&a.Utilities.isBoolean(c.saveGlobal)&&(d=c.saveGlobal),this._total_items=0,this._loaded_items=0,this.save_global=d,this._data={},this._failed_ids=[],this._loaded_ids=[]}return __extends(c,b),c.prototype._loaded=function(b,c){this.save_global?a.Preload.DATA[b]=c:this._data[b]=c,this.dispatchEvent("fileload",{id:b,data:c}),this._loaded_items++,this._loaded_ids.push(b),this._loaded_items>=this._total_items&&this._loading_complete()},c.prototype._failed_to_load=function(a){this._loaded_items++,this._failed_ids.push(a),this._loaded_items>=this._total_items&&this._loading_complete()},c.prototype._loading_complete=function(){this.dispatchEvent("complete",{failed_ids:this._failed_ids,loaded_ids:this._loaded_ids}),this._failed_ids.length=0,this._loaded_ids.length=0,this._loaded_items=0,this._total_items=0},c.prototype._on_error=function(a,b){this.dispatchEvent("error",{event:a,id:b})},c.prototype._on_abort=function(a,b){this.dispatchEvent("abort",{event:a,id:b})},c.prototype._on_progress=function(a){var b=0;a.lengthComputable&&(b=a.loaded/a.total);var c=Math.round((b+this._loaded_items)/this._total_items*100);this.dispatchEvent("progress",c)},c.prototype.load=function(b,c,d){var e;if(e="undefined"==typeof e?a.Preload.getType(c):a.Preload.TYPES[d],!e)throw new Error("Invalid file type.");var f=this;this._total_items++;var g=new XMLHttpRequest;g.open("get",c,!0),g.responseType=a.Preload.RESPONSE_TYPE[e],g.addEventListener("error",function(a){f._on_error(a,b)}),g.addEventListener("abort",function(a){f._on_abort(a,b)}),g.addEventListener("progress",function(a){f._on_progress(a)}),g.addEventListener("load",function(d){if(200!==this.status)return void f._failed_to_load(b);var g=this.response;if("image"===e){var h=new Image;h.src=window.URL.createObjectURL(g),h.onload=function(){f._loaded(b,h)}}else if("json"===e){if("string"==typeof g)try{g=JSON.parse(g)}catch(i){return void f._failed_to_load(b)}f._loaded(b,g)}else"audio"===e?a.Sound.decodeAudio(g,function(a){return a?void f._loaded(b,a):void console.log("Error decoding audio file:",b,c)}):f._loaded(b,g)},!1),g.send()},c.prototype.loadManifest=function(a,b){var c=a.length;"undefined"==typeof b&&(b="");for(var d=0;c>d;d++){var e=a[d];this.load(e.id,b+e.path)}},c.prototype.get=function(a){return this._data[a]},c}(a.EventDispatcher);a.Preload=b;var b;!function(a){function b(b){return a.DATA[b]}function c(b){var c=b.split(".").pop();for(var d in a.EXTENSIONS)if(a.EXTENSIONS.hasOwnProperty(d)&&a.EXTENSIONS[d].indexOf(c)>=0)return d;return null}!function(a){a[a.image=0]="image",a[a.json=1]="json",a[a.text=2]="text",a[a.audio=3]="audio"}(a.TYPES||(a.TYPES={}));a.TYPES;a.EXTENSIONS={image:["png","jpg","jpeg"],json:["json"],text:["txt"],audio:["ogg","mp3"]},a.RESPONSE_TYPE={image:"blob",json:"json",text:"text",audio:"arraybuffer"},a.DATA={},a.get=b,a.getType=c}(b=a.Preload||(a.Preload={}))}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),"undefined"==typeof a.fill&&(a.fill=!0),this.fill=a.fill,this._width=a.width,this._height=a.height,this._half_width=a.width/2,this._half_height=a.height/2,this.color=a.color}return __extends(c,b),c.prototype.drawElement=function(a){a.save(),a.beginPath(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.scale(this.scaleX,this.scaleY),a.rotate(this._rotation),this.fill?(a.fillStyle=this.color,a.fillRect(-this._half_width,-this._half_height,this._width,this._height)):(a.strokeStyle=this.color,a.strokeRect(-this._half_width,-this._half_height,this._width,this._height)),a.restore()},c.prototype.clone=function(){var b=new a.Rectangle({x:this.x,y:this.y,width:this._width,height:this._height,color:this.color,fill:this.fill});return b.opacity=this.opacity,b.visible=this.visible,b.scaleX=this.scaleX,b.scaleY=this.scaleY,b._rotation=this._rotation,b},c}(a.Element);a.Rectangle=b}(Game||(Game={}));var Game;!function(a){var b;!function(a){!function(a){a[a.left=0]="left",a[a.right=1]="right",a[a.top=2]="top",a[a.bottom=3]="bottom"}(a.Direction||(a.Direction={}));a.Direction}(b=a.ScrollingBitmapArgs||(a.ScrollingBitmapArgs={}));var c=function(c){function d(a){c.call(this,a),this._count=0,this._ref_position=0,this._step=a.step,this.setDirection(a.direction),"undefined"!=typeof a.interval&&this.setInterval(a.interval)}return __extends(d,c),d.prototype.setDirection=function(a){switch(this._direction=a,a){case b.Direction.left:this._scroll=this.scroll_left,this.drawElement=this._draw_horizontal;break;case b.Direction.right:this._scroll=this.scroll_right,this.drawElement=this._draw_horizontal;break;case b.Direction.top:this._scroll=this.scroll_top,this.drawElement=this._draw_vertical;break;case b.Direction.bottom:this._scroll=this.scroll_bottom,this.drawElement=this._draw_vertical}},d.prototype.setStep=function(a){this._step=a},d.prototype.setInterval=function(a){this._count=0,this._interval=a,this._has_logic=!0},d.prototype.clearInterval=function(){this._has_logic=!1},d.prototype.scroll_left=function(){this._ref_position+=this._step,this._ref_position>=this._width&&(this._ref_position=0)},d.prototype.scroll_right=function(){this._ref_position-=this._step,this._ref_position<0&&(this._ref_position=this._width)},d.prototype.scroll_top=function(){this._ref_position+=this._step,this._ref_position>=this._height&&(this._ref_position=0)},d.prototype.scroll_bottom=function(){this._ref_position-=this._step,this._ref_position<0&&(this._ref_position=this._height)},d.prototype._draw_horizontal=function(a){a.save(),a.beginPath(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.scale(this.scaleX,this.scaleY),a.rotate(this._rotation),a.drawImage(this._image,this._source_x+this._ref_position,this._source_y,this._width-this._ref_position,this._height,-this._half_width,-this._half_height,this._width-this._ref_position,this._height),a.drawImage(this._image,this._source_x,this._source_y,this._ref_position,this._height,this._half_width-this._ref_position,-this._half_height,this._ref_position,this._height),a.restore()},d.prototype._draw_vertical=function(a){a.save(),a.beginPath(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.scale(this.scaleX,this.scaleY),a.rotate(this._rotation),a.drawImage(this._image,this._source_x,this._source_y+this._ref_position,this._width,this._height-this._ref_position,-this._half_width,-this._half_height,this._width,this._height-this._ref_position),a.drawImage(this._image,this._source_x,this._source_y,this._width,this._ref_position,-this._half_width,this._half_height-this._ref_position,this._width,this._ref_position),a.restore()},d.prototype.logic=function(a){this._count+=a,this._count>=this._interval&&(this._count=0,this._scroll())},d.prototype.clone=function(){var b=new a.ScrollingBitmap({x:this.x,y:this.y,image:this._image,direction:this._direction,step:this._step,interval:this._interval});return b.opacity=this.opacity,b.visible=this.visible,b.scaleX=this.scaleX,b.scaleY=this.scaleY,b._rotation=this._rotation,b._count=this._count,b._ref_position=this._ref_position,b},d}(a.Bitmap);a.ScrollingBitmap=c}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this._width=a.frameWidth,this._height=a.frameHeight,this._half_width=a.frameWidth/2,this._half_height=a.frameHeight/2,this._frames_per_line=Math.floor(a.image.width/a.frameWidth),this._current_animation_position=0,this._count_interval=0,this.setFrame(0),"undefined"==typeof a.animations?(this._animations={},this.interval=1):(this._animations=a.animations,this.interval=a.interval)}return __extends(c,b),c.prototype.setFrame=function(a){var b=Math.floor(a/this._frames_per_line),c=a-b*this._frames_per_line;this._source_x=c*this._width,this._source_y=b*this._height},c.prototype.play=function(a,b){void 0===b&&(b=!1);var c=this._animations[a];return c?c===this._current_animation?(b===!0&&(this._current_animation_position=0,this._count_interval=0,this.setFrame(this._current_animation[0])),!0):(this._current_animation=c,this._current_animation_position=0,this._count_interval=0,this._has_logic=!0,this.setFrame(this._current_animation[this._current_animation_position]),!0):!1},c.prototype.stop=function(){this._has_logic=!1},c.prototype.nextFrame=function(){this._current_animation_position++,this._current_animation_position>=this._current_animation.length&&(this._current_animation_position=0),this.setFrame(this._current_animation[this._current_animation_position])},c.prototype.logic=function(a){this._count_interval+=a,this._count_interval>=this.interval&&(this._count_interval=0,this.nextFrame())},c.prototype.clone=function(){var b=new a.Sprite({x:this.x,y:this.y,image:this.image,frameWidth:this._width,frameHeight:this._height,animations:this._animations,interval:this.interval});return b.opacity=this.opacity,b.visible=this.visible,b.scaleX=this.scaleX,b.scaleY=this.scaleY,b._rotation=this._rotation,b},c}(a.Bitmap);a.Sprite=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(c){var d=this;if("undefined"==typeof c&&(c={}),"undefined"==typeof c.text&&(c.text=""),"undefined"==typeof c.fontFamily&&(c.fontFamily="monospace"),"undefined"==typeof c.fontSize&&(c.fontSize=20),"undefined"==typeof c.textAlign&&(c.textAlign="start"),"undefined"==typeof c.textBaseline&&(c.textBaseline="top"),"undefined"==typeof c.fill&&(c.fill=!0),"undefined"==typeof c.color&&(c.color="black"),b.call(this,c),this._font_size=c.fontSize,this.text=c.text,this.font_family=c.fontFamily,this.color=c.color,this.textAlign=c.textAlign,this.textBaseline=c.textBaseline,this.fill=c.fill,this._timeout=c.timeout,a.Utilities.isNumber(c.timeout)&&c.timeout>0){var e=new a.Utilities.Timeout;e.start(function(){d.remove()},1e3*c.timeout)}}return __extends(c,b),c.prototype.drawElement=function(a){a.save(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.scale(this.scaleX,this.scaleY),a.rotate(this._rotation),a.font=this._font,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;for(var b=this._lines.length,c=0;b>c;c++){var d=c*this.font_size;this.fill?(a.fillStyle=this.color,a.fillText(this._lines[c],0,d)):(a.strokeStyle=this.color,a.strokeText(this._lines[c],0,d))}a.restore()},Object.defineProperty(c.prototype,"text",{get:function(){return this._text},set:function(b){this._text=b,this._lines=this._text.split("\n");for(var c,d=a.getCanvas().getCanvasContext(),e=this._lines[0],f=d.measureText(e).width,g=this._lines.length,h=1;g>h;h++)e=this._lines[h],c=d.measureText(e).width,c>f&&(f=c);this._width=f,this._height=this.font_size*g,this._half_width=this._width/2,this._half_height=this._height/2},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"font_family",{get:function(){return this._font_family},set:function(a){this._font_family=a,this._font=this._font_size+"px "+a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"font_size",{get:function(){return this._font_size},set:function(a){this._font_size=a,this._font=a+"px "+this._font_family},enumerable:!0,configurable:!0}),c.prototype.clone=function(){var b=new a.Text({x:this.x,y:this.y,text:this._text,fontFamily:this._font_family,fontSize:this._font_size,timeout:this._timeout,textAlign:this.textAlign,textBaseline:this.textBaseline,fill:this.fill});return b.opacity=this.opacity,b.visible=this.visible,b.scaleX=this.scaleX,b.scaleY=this.scaleY,b._rotation=this._rotation,b},c}(a.Element);a.Text=b}(Game||(Game={}));var Game;!function(a){!function(a){a[a.properties=0]="properties",a[a.wait=1]="wait",a[a.call=2]="call"}(a.TweenAction||(a.TweenAction={}));var b=a.TweenAction,c=function(){function c(a){this._element=a,this._steps=[],this._current_step=null,this._start_properties=null,this._count=0,this._update=null}return c.prototype.start=function(){this.nextStep(),c._tweens.push(this)},c.prototype.to=function(c,d,e){return"undefined"==typeof e&&(e=a.Tween.Ease.linear),this._steps.push({action:b.properties,end_properties:c,duration:d,ease:e}),this},c.prototype.wait=function(a){return this._steps.push({action:b.wait,duration:a}),this},c.prototype.call=function(a){return this._steps.push({action:b.call,callback:a}),this},c.prototype.remove=function(){var a=c._tweens.indexOf(this);c._tweens.splice(a,1)},c.prototype.nextStep=function(){var a=this._steps.shift();if(!a)return void this.remove();if(this._current_step=a,a.action===b.call)a.callback(),this.nextStep();else if(a.action===b.wait)this._count=0,this._update=this.waitUpdate;else if(a.action===b.properties){var c={};for(var d in a.end_properties)c[d]=this._element[d];this._start_properties=c,this._count=0,this._update=this.propertiesUpdate}},c.prototype.waitUpdate=function(a){var b=this._current_step;this._count+=a,this._count>=b.duration&&this.nextStep()},c.prototype.propertiesUpdate=function(a){var b=this._current_step;this._count+=a;var c=this._count/b.duration,d=b.ease(c);for(var e in b.end_properties){var f=this._start_properties[e],g=b.end_properties[e];this._element[e]=f+(g-f)*d}if(this._count>=b.duration){for(var e in b.end_properties)this._element[e]=b.end_properties[e];this.nextStep()}},c.getTween=function(a){for(var b=c._tweens.length-1;b>=0;b--){var d=c._tweens[b];if(d._element===a)return d}return null},c.removeTweens=function(a){for(var b=c._tweens.length-1;b>=0;b--){var d=c._tweens[b];d._element===a&&c._tweens.splice(b,1)}},c.removeAll=function(){c._tweens.length=0},c.update=function(a){for(var b=c._tweens.length-1;b>=0;b--)c._tweens[b]._update(a)},c._tweens=[],c}();a.Tween=c;var c;!function(a){var b;!function(a){function b(a){return a}function c(a){return a*a}a.linear=b,a.quadraticIn=c}(b=a.Ease||(a.Ease={}))}(c=a.Tween||(a.Tween={}))}(Game||(Game={}));var Game;!function(a){!function(a){a[a.stop=0]="stop",a[a.angle=1]="angle",a[a.destination=2]="destination",a[a.loop=3]="loop",a[a.follow=4]="follow"}(a.UnitMovement||(a.UnitMovement={}));var b=a.UnitMovement,c=function(c){function d(a){c.call(this,a),"undefined"==typeof a&&(a={}),"undefined"==typeof a.movementSpeed&&(a.movementSpeed=50),"undefined"==typeof a.health&&(a.health=1),this.movement_speed=a.movementSpeed,this.health=a.health,this._movement_type=b.stop,this._is_moving=!1,this._move_x=0,this._move_y=0,this._move_callback=null,this._destination_x=0,this._destination_y=0,this._path=[],this._loop_path_position=0,this._is_destination_x_diff_positive=!1,this._is_destination_y_diff_positive=!1,this._follow_target=null,this._weapons=[];var d=this.constructor;"undefined"==typeof d._all&&(d._all=[]),"undefined"==typeof d.collidesWith&&(d.collidesWith=[]),d._all.push(this)}return __extends(d,c),d.prototype.addWeapon=function(a){return this._weapons.push(a),a.element=this,this._weapons.length-1},d.prototype.removeWeapon=function(a){var b=this._weapons.splice(a,1)[0];return b.element=null,b},d.prototype.getWeapon=function(a){return this._weapons[a]},d.prototype.getAllWeapons=function(){return this._weapons},d.prototype.remove=function(b){if("undefined"==typeof b)this._removeNow();else{var c=new a.Tween(this),d=this;c.to({opacity:0},b).call(function(){d._removeNow()}),c.start()}},d.prototype._removeNow=function(){if(!this._removed){this.stop(),c.prototype.remove.call(this);var a=this.constructor,b=a._all,d=b.indexOf(this);b.splice(d,1)}},d.prototype.moveTo=function(c,d,e){a.Utilities.isFunction(e)||(e=null),this._movement_type=b.destination,this._path.length=0,this._path.push({x:c,y:d,callback:e}),this.movementLogic=this.movementPathLogic,this.moveToNext()},d.prototype.moveToNext=function(){var c;if(this._movement_type===b.loop?(this._loop_path_position++,this._loop_path_position>=this._path.length&&(this._loop_path_position=0),c=this._path[this._loop_path_position]):c=this._path.shift(),c){var d=c.x,e=c.y;this._is_moving=!0,this._destination_x=d,this._destination_y=e,this._move_callback=c.callback,this._is_destination_x_diff_positive=d-this.x>0,this._is_destination_y_diff_positive=e-this.y>0;var f=a.Utilities.calculateAngle(this.x,-1*this.y,d,-1*e);return this._move_x=Math.cos(f)*this.movement_speed,this._move_y=Math.sin(f)*this.movement_speed,!0}return this._is_moving=!1,!1},d.prototype.stop=function(){this._movement_type=b.stop,this._path.length=0,this._is_moving=!1,this._follow_target=null},d.prototype.queueMoveTo=function(b,c,d){return a.Utilities.isFunction(d)||(d=null),this._is_moving?void this._path.push({x:b,y:c,callback:d}):void this.moveTo(b,c,d)},d.prototype.moveLoop=function(a){this._movement_type=b.loop,this._path=a,this._loop_path_position=-1,this.movementLogic=this.movementPathLogic,this.moveToNext()},d.prototype.moveAngle=function(a,c,d){c===!0&&(a=Math.PI/180*a),this._movement_type=b.angle,this._is_moving=!0,this._move_x=Math.cos(a)*this.movement_speed,this._move_y=Math.sin(a)*this.movement_speed,this.rotation=a,this._move_callback=d,this.movementLogic=this.movementAngleLogic},d.prototype.follow=function(a){this._movement_type=b.follow,this._follow_target=a,this.movementLogic=this.movementFollowLogic},d.prototype.movementLogic=function(a){},d.prototype.movementFollowLogic=function(b){var c=this._follow_target;c.isRemoved()&&this.stop();var d=a.Utilities.calculateAngle(this.x,-1*this.y,c.x,-1*c.y);this.x+=Math.cos(d)*this.movement_speed*b,this.y+=Math.sin(d)*this.movement_speed*b,this.rotation=d},d.prototype.movementAngleLogic=function(b){this._is_moving&&(this.x+=this._move_x*b,this.y+=this._move_y*b,a.getCanvas().isInCanvas(this.x,this.y)||this._move_callback&&this._move_callback())},d.prototype.movementPathLogic=function(a){if(this._is_moving){this.x+=this._move_x*a,this.y+=this._move_y*a;var b=this._destination_x-this.x,c=this._destination_y-this.y;if(this._is_destination_x_diff_positive&&(b*=-1),this._is_destination_y_diff_positive&&(c*=-1),b>=0&&c>=0){this.x=this._destination_x,this.y=this._destination_y;var d=this._move_callback;this.moveToNext(),d&&d()}}},d.prototype.collisionLogic=function(b){var c=this.constructor,d=c.collidesWith.length;if(d>0&&this.hasListeners("collision")){var e=this.getVertices();if(!e)return;for(var f=0;d>f;f++){var g=c.collidesWith[f]._all;if(g)for(var h=g.length-1;h>=0;h--){var i=g[h];if(i!==this){var j=i.getVertices();if(!j)return;if(a.CollisionDetection.polygonPolygonList(e,j))return void this.dispatchEvent("collision",{element:this,collidedWith:i});for(var k=this._weapons.length-1;k>=0;k--)if(this._weapons[k].checkCollision(i,j))return}}}}},d.prototype.logic=function(a){this.movementLogic(a);for(var b=this._weapons.length-1;b>=0;b--)this._weapons[b].logic(a);this.collisionLogic(a)},d.prototype.clone=function(){var b,c=[],d=this._children.length;for(b=0;d>b;b++)c.push(this._children[b].clone());var e=new a.Unit({x:this.x,y:this.y,children:c,movementSpeed:this.movement_speed,health:this.health});for(e.opacity=this.opacity,e.visible=this.visible,e.scaleX=this.scaleX,e.scaleY=this.scaleY,b=0;b<this._weapons.length;b++)e._weapons.push(this._weapons[b].clone());return e},d}(a.Container);a.Unit=c}(Game||(Game={}));var Game;!function(a){var b;!function(a){function b(a,b){return{x:a.x+b.x,y:a.y+b.y}}function c(a,b){return{x:a.x-b.x,y:a.y-b.y}}function d(a){var b=a.x,c=a.y;return Math.sqrt(b*b+c*c)}function e(a,b){return{x:a.x*b,y:a.y*b}}function f(a,b){return a.x*b.x+a.y*b.y}function g(a,b,c){var d=a.x,e=a.y,f=Math.cos(c),g=Math.sin(c),h=b.x-d,i=b.y-e;return{x:d+h*f-i*g,y:e+h*g+i*f}}function h(a){return{x:a.y,y:-a.x}}function i(a){return{x:-a.y,y:a.x}}function j(a){var b=a.x,c=a.y,d=Math.sqrt(b*b+c*c);return{x:b/d,y:c/d}}function k(a,b){var c=f(a,b),d=b.x,e=b.y,g=d*d+e*e;return{x:c/g*d,y:c/g*e}}a.add=b,a.subtract=c,a.magnitude=d,a.multiply=e,a.dotProduct=f,a.rotate=g,a.normalLeft=h,a.normalRight=i,a.normalize=j,a.projection=k}(b=a.Vector||(a.Vector={}))}(Game||(Game={}));var Game;!function(a){var b=function(){function b(b){"undefined"==typeof b.damage&&(b.damage=1),"undefined"==typeof b.fireInterval&&(b.fireInterval=0),this.element=null,this.damage=b.damage,this.fire_interval=b.fireInterval,this._fire_count=0,this._is_ready=!0;var c=new a.Rectangle({width:10,height:2,color:"blue"}),d=new a.Bullet({angleOrTarget:0,children:c,movementSpeed:100});this._bullet_types=[d],this._bullet_intervals=[],this._bullet_container=b.bulletContainer,this._bullets=[]}return b.prototype.addBulletType=function(a){return this._bullet_types.push(a),this._bullet_types.length-1},b.prototype.stopFiring=function(){this._bullet_intervals.length=0},b.prototype.firingPattern=function(a,b){return this._fire(a,b)},b.prototype.fire=function(a,b){return this._is_ready?(this._fire_count=0,this._is_ready=!1,"undefined"==typeof b&&(b=0),"undefined"==typeof a&&(a=this.element?this.element.rotation:0),this.firingPattern(a,b)):!1},b.prototype.forceFire=function(b,c,d){return"undefined"==typeof c&&(c=0),"undefined"==typeof b&&(b=this.element?this.element.rotation:0),a.Utilities.isNumber(d)&&d>0&&this._bullet_intervals.push({count:0,interval:d,bulletId:c,angleOrTarget:b}),this.firingPattern(b,c)},b.prototype._fire=function(a,b){var c=this;if("number"!=typeof a&&a.isRemoved()===!0)return!1;var d=this._bullet_types[b].clone();return"number"==typeof a?d.setAngle(a):d.setTarget(a),this.element&&(d.x=this.element.x,d.y=this.element.y,d.addEventListener("collision",function(a){c.element.dispatchEvent("collision",{element:c.element,bullet:a.element,collidedWith:a.collidedWith})})),d.addEventListener("remove",function(a){var b=c._bullets.indexOf(d);c._bullets.splice(b,1)}),this._bullet_container.addChild(d),this._bullets.push(d),!0},b.prototype.logic=function(a){this._fire_count>=this.fire_interval?this._is_ready=!0:this._fire_count+=a;var b=this._bullet_intervals;if(b.length>0)for(var c=b.length-1;c>=0;c--){var d=b[c];if(d.count+=a,d.count>=d.interval){var e=this.firingPattern(d.angleOrTarget,d.bulletId);e?d.count=0:b.splice(c,1)}}},b.prototype.checkCollision=function(b,c){for(var d=this._bullets.length-1;d>=0;d--){var e=this._bullets[d],f=e.getVertices();if(!f)return;if(a.CollisionDetection.polygonPolygonList(c,e.getVertices()))return this.element.dispatchEvent("collision",{element:this.element,bullet:e,collidedWith:b}),!0}return!1},b.prototype.isReady=function(){return this._is_ready},b.prototype.clone=function(){for(var b=new a.Weapon({bulletContainer:this._bullet_container,fireInterval:this.fire_interval,damage:this.damage}),c=1;c<this._bullet_types.length;c++)b._bullet_types.push(this._bullet_types[c].clone());return b},b}();a.Weapon=b}(Game||(Game={}));